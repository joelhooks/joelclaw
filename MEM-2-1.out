Implemented MEM-2 in `packages/system-bus/src/inngest/client.ts` by adding these event schema entries to `Events`:

- `memory/proposal.approved` with:
  - `proposalId: string`
  - `approvedBy: string`
- `memory/proposal.rejected` with:
  - `proposalId: string`
  - `reason: string`
  - `rejectedBy: string`

Validation passed:

- `bunx tsc --noEmit` exited successfully with no TypeScript errors.


--- STDERR ---
OpenAI Codex v0.101.0 (research preview)
--------
workdir: /private/tmp/agent-loop/loop-mlr8oxtg-b68bp4
model: gpt-5.3-codex
provider: openai
approval: never
sandbox: workspace-write [workdir, /tmp, $TMPDIR]
reasoning effort: none
reasoning summaries: auto
session id: 019c6df8-14dd-7b40-b825-50fb2d044438
--------
user


## Project File Listing

pnpm-lock.yaml
infra
vercel.json
k8s
turbo.json
node_modules
bun.lock
docs
README.md
package.json
scripts
packages
tsconfig.json
prd.json
apps
Vault
MEM-1-1.out
pnpm-workspace.yaml

---

## Story: Add memory/proposal.approved and memory/proposal.rejected event types to client.ts (MEM-2)

In packages/system-bus/src/inngest/client.ts, add two new event type definitions to the EventSchemas map: 'memory/proposal.approved' with data shape { proposalId: string; approvedBy: string } and 'memory/proposal.rejected' with data shape { proposalId: string; reason: string; rejectedBy: string }. Follow the existing event type pattern in that file.

## Acceptance Criteria
- 'memory/proposal.approved' event type is defined in client.ts with proposalId and approvedBy fields
- 'memory/proposal.rejected' event type is defined in client.ts with proposalId, reason, and rejectedBy fields
- TypeScript compiles cleanly: bunx tsc --noEmit

## Instructions
Implement the story above. Do NOT write tests — a separate reviewer will handle testing.
Make clean, focused changes. Commit nothing — the harness handles git.
If your changes break existing tests (not just the ones for this story), fix those tests to match the new interface. Changing a type or adding a required field means updating all consumers.
mcp startup: no servers
2026-02-17T23:38:20.828380Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c6d78-f4bd-70a3-9b26-6d401f72555d
2026-02-17T23:38:20.900393Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c6a38-72b9-7fd3-aae0-de7058d752e1
2026-02-17T23:38:21.009140Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c5eca-bff9-7772-83bf-5daab07b9959
2026-02-17T23:38:21.118509Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c5ffd-d51d-7a13-b1fa-342be02f164b
2026-02-17T23:38:21.230385Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c6275-d69e-7b53-bb28-583bfe07e70c
2026-02-17T23:38:21.245931Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c6d76-b1ac-7312-a2bc-33ed66270397
2026-02-17T23:38:21.367358Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c6946-d832-73b3-bade-761321c88a0a
2026-02-17T23:38:21.490543Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c6d85-da78-7b62-99df-11a605673333
2026-02-17T23:38:21.578273Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c6bed-25bc-7141-bf68-7df6c001174c
2026-02-17T23:38:21.695819Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c6a5b-ba72-7f61-8273-d02deacae15e
2026-02-17T23:38:21.818256Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c6482-5bab-7e53-bc62-5239d048a3c8
2026-02-17T23:38:21.930455Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c6a51-1205-7a00-bbdb-509c1624de3d
2026-02-17T23:38:22.085648Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c6a59-ea9c-73e1-b537-9ad62ea24fd1
2026-02-17T23:38:22.218230Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c6d85-394c-7a22-a0ba-b3f326504c0f
2026-02-17T23:38:22.305111Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c6485-58f0-7261-8508-37f3fb9356dd
2026-02-17T23:38:22.462159Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c695b-193b-7040-9529-153a24848595
2026-02-17T23:38:22.528188Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c6031-b7fb-7120-85b5-8abf34324910
2026-02-17T23:38:22.631925Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c5fe2-872d-7e93-87a3-71d37d75a127
2026-02-17T23:38:22.693044Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c6d46-f863-7a62-8f46-d697792894dd
2026-02-17T23:38:22.794786Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c6a5d-a9a0-7003-8868-edeb59f5a8e9
2026-02-17T23:38:22.898568Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c6a4f-9a4d-7c13-aeef-771e0c9a7900

2026-02-17T23:38:23.043497Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c6022-8a12-7ba0-b7e8-9c265e8ec17e
thinking
**Planning skill usage and file editing**
2026-02-17T23:38:23.151452Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c5fbb-e145-7c40-9913-218548629e57
2026-02-17T23:38:23.228012Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c647c-8066-7eb1-8782-06a844370303
2026-02-17T23:38:23.329179Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c6bed-24ce-70e2-a3a9-72ea76928828
2026-02-17T23:38:23.463755Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c6a58-df8a-7560-894e-8c41ec0bc9ec
2026-02-17T23:38:23.528018Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c6bed-ca0f-7153-9527-6336e87fc2d0
2026-02-17T23:38:23.647672Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c5fed-5e04-78c0-9a4e-9fddc7af084e
2026-02-17T23:38:23.765302Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c6d75-a627-7be2-a5b9-708ae8d9ac39
codex
I’m implementing MEM-2 by updating the Inngest event schema types in `packages/system-bus/src/inngest/client.ts`, then I’ll run `bunx tsc --noEmit` to verify the workspace still compiles cleanly. I’ll check the relevant skill guidance first so the change matches existing patterns.
exec
/bin/zsh -lc "ls -la .agents/skills/inngest-events && sed -n '1,200p' .agents/skills/inngest-events/SKILL.md" in /private/tmp/agent-loop/loop-mlr8oxtg-b68bp4exec
/bin/zsh -lc "sed -n '1,260p' packages/system-bus/src/inngest/client.ts" in /private/tmp/agent-loop/loop-mlr8oxtg-b68bp4 succeeded in 52ms:
total 24
drwxr-xr-x   3 joel  wheel     96 Feb 17 15:33 .
drwxr-xr-x  57 joel  wheel   1824 Feb 17 15:33 ..
-rw-r--r--   1 joel  wheel  11738 Feb 17 15:33 SKILL.md
---
name: inngest-events
description: Design and send Inngest events. Covers event schema and payload format, naming conventions, IDs for idempotency, the ts param, fan-out patterns, and system events like inngest/function.failed.
---

# Inngest Events

Master Inngest event design and delivery patterns. Events are the foundation of Inngest - learn to design robust event schemas, implement idempotency, leverage fan-out patterns, and handle system events effectively.

> **These skills are focused on TypeScript.** For Python or Go, refer to the [Inngest documentation](https://www.inngest.com/llms.txt) for language-specific guidance. Core concepts apply across all languages.

## Event Payload Format

Every Inngest event is a JSON object with required and optional properties:

### Required Properties
 succeeded in 52ms:
import { Inngest, EventSchemas } from "inngest";

/**
 * ADR-0019: Event names describe what happened (past-tense), not commands.
 *
 * Agent Loop chain:
 *   started → story.dispatched → tests.written → code.committed
 *     → checks.completed → story.passed/failed/retried → completed
 *
 * Pipeline chain:
 *   video.requested → video.downloaded → transcript.requested
 *     → transcript.processed → summarize.requested → summarized
 */

// System event types
export type Events = {
  // --- Video pipeline ---
  "pipeline/video.requested": {
    data: {
      url: string;

thinking
**Planning to locate event map**
codex
I found the target file and confirmed it’s a typed `Events` map. Next I’m locating the memory event section and inserting the two new proposal events in the same style as existing entries.
exec
/bin/zsh -lc "sed -n '260,560p' packages/system-bus/src/inngest/client.ts" in /private/tmp/agent-loop/loop-mlr8oxtg-b68bp4 succeeded in 53ms:
  "agent/loop.story.failed": {
    data: {
      loopId: string;
      project: string;
      workDir?: string;
      prdPath: string;
      storyId: string;
      reason: string;
      attempts: number;
      duration?: number;
      maxIterations?: number;
      maxRetries?: number;
      retryLadder?: ("codex" | "claude" | "pi")[];
    };
  };

  /** Judge wants retry → triggers implementor */
  "agent/loop.story.retried": {
    data: {
      loopId: string;

thinking
**Inserting events in memory section**
codex
I’ve identified the Memory block and I’m applying a focused edit there to add `memory/proposal.approved` and `memory/proposal.rejected` with the exact payload shapes you specified.
file update
M /private/tmp/agent-loop/loop-mlr8oxtg-b68bp4/packages/system-bus/src/inngest/client.ts
@@ -401,2 +401,15 @@
   };
+  "memory/proposal.approved": {
+    data: {
+      proposalId: string;
+      approvedBy: string;
+    };
+  };
+  "memory/proposal.rejected": {
+    data: {
+      proposalId: string;
+      reason: string;
+      rejectedBy: string;
+    };
+  };
 
apply_patch(auto_approved=true) exited 0 in 39ms:
Success. Updated the following files:
M /private/tmp/agent-loop/loop-mlr8oxtg-b68bp4/packages/system-bus/src/inngest/client.ts
file update:
diff --git a/packages/system-bus/src/inngest/client.ts b/packages/system-bus/src/inngest/client.ts
index ded9cd8246c05cf335ed95743675e1cca03f94a1..f08fa9df353ba7f4b2dec9117253e525bcdcb78b
--- a/packages/system-bus/src/inngest/client.ts
+++ b/packages/system-bus/src/inngest/client.ts
@@ -399,6 +399,19 @@
       capturedAt: string;
     };
   };
+  "memory/proposal.approved": {
+    data: {
+      proposalId: string;
+      approvedBy: string;
+    };
+  };
+  "memory/proposal.rejected": {
+    data: {
+      proposalId: string;
+      reason: string;
+      rejectedBy: string;
+    };
+  };
 
   // --- Discovery ---
   "discovery/noted": {

file update:
diff --git a/packages/system-bus/src/inngest/client.ts b/packages/system-bus/src/inngest/client.ts
index ded9cd8246c05cf335ed95743675e1cca03f94a1..f08fa9df353ba7f4b2dec9117253e525bcdcb78b
--- a/packages/system-bus/src/inngest/client.ts
+++ b/packages/system-bus/src/inngest/client.ts
@@ -399,6 +399,19 @@
       capturedAt: string;
     };
   };
+  "memory/proposal.approved": {
+    data: {
+      proposalId: string;
+      approvedBy: string;
+    };
+  };
+  "memory/proposal.rejected": {
+    data: {
+      proposalId: string;
+      reason: string;
+      rejectedBy: string;
+    };
+  };
 
   // --- Discovery ---
   "discovery/noted": {


thinking
**Validating TypeScript compilation**
codex
The schema update is in place. I’m running `bunx tsc --noEmit` now to verify the workspace compiles without type errors after this change.
exec
/bin/zsh -lc 'bunx tsc --noEmit' in /private/tmp/agent-loop/loop-mlr8oxtg-b68bp4 succeeded in 489ms:

file update:
diff --git a/packages/system-bus/src/inngest/client.ts b/packages/system-bus/src/inngest/client.ts
index ded9cd8246c05cf335ed95743675e1cca03f94a1..f08fa9df353ba7f4b2dec9117253e525bcdcb78b
--- a/packages/system-bus/src/inngest/client.ts
+++ b/packages/system-bus/src/inngest/client.ts
@@ -399,6 +399,19 @@
       capturedAt: string;
     };
   };
+  "memory/proposal.approved": {
+    data: {
+      proposalId: string;
+      approvedBy: string;
+    };
+  };
+  "memory/proposal.rejected": {
+    data: {
+      proposalId: string;
+      reason: string;
+      rejectedBy: string;
+    };
+  };
 
   // --- Discovery ---
   "discovery/noted": {


thinking
**Preparing final summary with skill and results**
codex
Implemented MEM-2 in `packages/system-bus/src/inngest/client.ts` by adding these event schema entries to `Events`:

- `memory/proposal.approved` with:
  - `proposalId: string`
  - `approvedBy: string`
- `memory/proposal.rejected` with:
  - `proposalId: string`
  - `reason: string`
  - `rejectedBy: string`

Validation passed:

- `bunx tsc --noEmit` exited successfully with no TypeScript errors.
file update:
diff --git a/packages/system-bus/src/inngest/client.ts b/packages/system-bus/src/inngest/client.ts
index ded9cd8246c05cf335ed95743675e1cca03f94a1..f08fa9df353ba7f4b2dec9117253e525bcdcb78b
--- a/packages/system-bus/src/inngest/client.ts
+++ b/packages/system-bus/src/inngest/client.ts
@@ -399,6 +399,19 @@
       capturedAt: string;
     };
   };
+  "memory/proposal.approved": {
+    data: {
+      proposalId: string;
+      approvedBy: string;
+    };
+  };
+  "memory/proposal.rejected": {
+    data: {
+      proposalId: string;
+      reason: string;
+      rejectedBy: string;
+    };
+  };
 
   // --- Discovery ---
   "discovery/noted": {

tokens used
29,226
