{
  "title": "Migrate joelclaw CLI into monorepo packages/cli",
  "description": "Replace the stale packages/cli/ scaffold with the current working CLI from ~/Code/joelhooks/joelclaw-cli/. The standalone repo has 16 source files (cli.ts, 11 command files, config.ts, inngest.ts, response.ts, schema.ts) with the joelclaw rename already done in cli.ts and response.ts but NOT in schema.ts, status.ts, inngest.ts, and several command files that still say 'igs'. Complete the rename, add the note subcommand, and wire everything up. The standalone repo at ~/Code/joelhooks/joelclaw-cli/ is the reference — copy its src/ contents into packages/cli/src/, update package.json deps, then finish the remaining work.",
  "stories": [
    {
      "id": "COPY-1",
      "title": "Copy current CLI source into packages/cli and update deps",
      "description": "Delete the stale contents of packages/cli/src/ and replace with the full source tree from ~/Code/joelhooks/joelclaw-cli/src/ (cli.ts, commands/*.ts, config.ts, inngest.ts, response.ts, schema.ts). Update packages/cli/package.json to include all dependencies from the standalone (ioredis, @effect/cli, @effect/platform, @effect/platform-bun, effect). Add the igs legacy bin entry: \"igs\": \"src/cli.ts\". Remove the stale .d.ts shim files (fetch-json-compat.d.ts, globals.d.ts) that are no longer needed. Run bun install from the monorepo root.",
      "acceptance_criteria": [
        "packages/cli/src/commands/ directory exists with all 11 command files (diagnose.ts, discover.ts, events.ts, logs.ts, loop.ts, refresh.ts, runs.ts, schema.ts, send.ts, status.ts, watch.ts)",
        "packages/cli/src/ has cli.ts, config.ts, inngest.ts, response.ts, schema.ts",
        "packages/cli/package.json has ioredis in dependencies",
        "packages/cli/package.json bin has both joelclaw and igs entries",
        "No stale .d.ts shim files (fetch-json-compat.d.ts, globals.d.ts) remain",
        "bun install succeeds from monorepo root",
        "bun run packages/cli/src/cli.ts --help shows joelclaw help"
      ],
      "priority": 1,
      "status": "merged"
    },
    {
      "id": "RENAME-1",
      "title": "Complete igs→joelclaw rename in all source files",
      "description": "Several files still reference 'igs' in user-facing strings. Update ALL remaining references: (1) inngest.ts Effect.Service tag 'igs/Inngest' → 'joelclaw/Inngest', (2) schema.ts examples that say 'igs send' → 'joelclaw send', 'igs loop' → 'joelclaw loop', 'igs functions' → 'joelclaw functions', (3) status.ts next_actions that say 'igs functions' etc, (4) response.ts normalizeCommand already handles prefix replacement but verify it catches all cases, (5) any variable named 'igs' in cli.ts and command files should be renamed to something clearer (e.g. 'client' or 'inngestClient'). Internal Effect service tags and variable names are fine to update — they're not in any external contract.",
      "acceptance_criteria": [
        "grep -rn '\\bigs\\b' packages/cli/src/ returns zero matches (no remaining 'igs' references)",
        "bun run packages/cli/src/cli.ts --help shows 'joelclaw' not 'igs'",
        "bun run packages/cli/src/cli.ts schema output uses 'joelclaw' in all examples",
        "bun run packages/cli/src/cli.ts status output uses 'joelclaw' in next_actions",
        "TypeScript compiles: cd packages/cli && bunx tsc --noEmit"
      ],
      "priority": 2
    },
    {
      "id": "NOTE-1",
      "title": "Add joelclaw note subcommand",
      "description": "Add a 'joelclaw note' subcommand in packages/cli/src/commands/note.ts that captures a thought to the Redis note queue. It accepts a text argument and optional --source and --tags flags. It writes to Redis using RPUSH to key 'joelclaw:notes:queue' as JSON with fields: id (nanoid or crypto.randomUUID), text, source (default 'cli'), createdAt (ISO timestamp), tags (string array), status ('pending'). Also sends a 'system/note.captured' event to Inngest with the same payload. Output is HATEOAS JSON with the created note and next_actions. Wire the command into cli.ts's root command withSubcommands. Use the existing Inngest service for the event send and create a Redis connection using ioredis (same host/port pattern as the worker: REDIS_HOST/REDIS_PORT env vars with localhost:6379 defaults).",
      "acceptance_criteria": [
        "packages/cli/src/commands/note.ts exists",
        "note command is wired into cli.ts withSubcommands",
        "joelclaw note 'test thought' writes to Redis key joelclaw:notes:queue",
        "Note JSON has fields: id, text, source, createdAt, tags, status",
        "Default source is 'cli', default tags is empty array, status is 'pending'",
        "--source flag overrides the source field",
        "--tags flag accepts comma-separated tags string",
        "A system/note.captured event is sent to Inngest",
        "Output is HATEOAS JSON with created note and next_actions",
        "TypeScript compiles: cd packages/cli && bunx tsc --noEmit"
      ],
      "priority": 3
    }
  ],
  "checks": ["tsc"]
}
