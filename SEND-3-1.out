Implemented SEND-3 across all remaining sites in `src/inngest/functions` by replacing `inngest.send()` with `step.sendEvent(stepId, payload)` and preserving the existing step IDs.

Updated call sites:
- `src/inngest/functions/agent-loop/retro.ts:377`
- `src/inngest/functions/agent-loop/implement.ts:456`
- `src/inngest/functions/agent-loop/judge.ts:390`
- `src/inngest/functions/agent-loop/judge.ts:425`
- `src/inngest/functions/agent-loop/judge.ts:488`
- `src/inngest/functions/agent-loop/review.ts:393`
- `src/inngest/functions/agent-loop/plan.ts:363`
- `src/inngest/functions/agent-loop/plan.ts:434`
- `src/inngest/functions/agent-loop/plan.ts:504`
- `src/inngest/functions/summarize.ts:67`
- `src/inngest/functions/discovery-capture.ts:101`

Validation:
- `grep -r "inngest.send" src/inngest/functions/ --include="*.ts" | grep -v test` returned no matches.
- `bunx tsc --noEmit` passed cleanly.


--- STDERR ---
OpenAI Codex v0.101.0 (research preview)
--------
workdir: /private/tmp/agent-loop/loop-mlq3ts3f-tefwji/packages/system-bus
model: gpt-5.3-codex
provider: openai
approval: never
sandbox: workspace-write [workdir, /tmp, $TMPDIR]
reasoning effort: none
reasoning summaries: auto
session id: 019c69ea-b881-7411-a308-a6b84a15e548
--------
user


## Project File Listing

docker
prd-v3-recovery.json
prd-adr-0010.json
progress.txt
node_modules
prd-retro.json
bun.lock
README.md
__tests__
package.json
scripts
tsconfig.json
docker-compose.yml
prd-v2.json
index.ts
CONTINUATION.md
prd.json
start.sh
CLAUDE.md
prd-cli-migration.json
src
CONTINUATION-ADR.md

# src/ files:
src/inngest/client.ts
src/serve.ts

## Project Instructions (CLAUDE.md)


## Agent Loop Architecture (ADR-0015)

This project runs automated coding loops with 5 separated roles:
- **Planner**: generates PRD from goal, picks next story
- **Test Writer**: writes acceptance tests BEFORE implementation (TDD)
- **Implementor**: writes code to pass the tests
- **Reviewer**: evaluates implementation with 4 questions (no test writing)
- **Judge**: mechanical gates + reviewer notes + LLM verdict

When working as an implementor: implement the story, don't write tests.
When working as a test writer: write tests from acceptance criteria only, don't read implementation.
Tests should verify observable behavior and public API ‚Äî NOT internal structure.
Do NOT use source code string matching (indexOf, regex on source) to verify behavior.
Commit nothing ‚Äî the harness handles git.

## Bun Runtime

Default to using Bun instead of Node.js.

- Use `bun <file>` instead of `node <file>` or `ts-node <file>`
- Use `bun test` instead of `jest` or `vitest`
- Use `bun build <file.html|file.ts|file.css>` instead of `webpack` or `esbuild`
- Use `bun install` instead of `npm install` or `yarn install` or `pnpm install`
- Use `bun run <script>` instead of `npm run <script>` or `yarn run <script>` or `pnpm run <script>`
- Use `bunx <package> <command>` instead of `npx <package> <command>`
- Bun automatically loads .env, so don't use dotenv.

## APIs

- `Bun.serve()` supports WebSockets, HTTPS, and routes. Don't use `express`.
- `bun:sqlite` for SQLite. Don't use `better-sqlite3`.
- `Bun.redis` for Redis. Don't use `ioredis`.
- `Bun.sql` for Postgres. Don't use `pg` or `postgres.js`.
- `WebSocket` is built-in. Don't use `ws`.
- Prefer `Bun.file` over `node:fs`'s readFile/writeFile
- Bun.$`ls` instead of execa.

## Testing

Use `bun test` to run tests.

```ts#index.test.ts
import { test, expect } from "bun:test";

test("hello world", () => {
  expect(1).toBe(1);
});
```

## Frontend

Use HTML imports with `Bun.serve()`. Don't use `vite`. HTML imports fully support React, C

---

## Story: Replace inngest.send() with step.sendEvent() in all remaining agent-loop functions (SEND-3)

Find all remaining inngest.send() calls inside step.run() wrappers across all files in src/inngest/functions/ not already covered by SEND-1 and SEND-2 (e.g. plan.ts, reflect.ts, promote.ts, content-sync.ts, vault-sync.ts, discovery-capture.ts, summarize.ts, and any agent-loop subfunctions). Replace each with step.sendEvent() using the same step ID. Run: grep -r "inngest.send" src/inngest/functions/ --include="*.ts" | grep -v test to find all remaining sites. The final result must be zero matches.

## Acceptance Criteria
- grep -r "inngest.send" src/inngest/functions/ --include="*.ts" | grep -v test returns 0 matches
- step.sendEvent() is used for all event emission inside Inngest function handlers
- TypeScript compiles cleanly: bunx tsc --noEmit

## Instructions
Implement the story above. Do NOT write tests ‚Äî a separate reviewer will handle testing.
Make clean, focused changes. Commit nothing ‚Äî the harness handles git.
If your changes break existing tests (not just the ones for this story), fix those tests to match the new interface. Changing a type or adding a required field means updating all consumers.
mcp startup: no servers
2026-02-17T04:45:16.374271Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c5eca-bff9-7772-83bf-5daab07b9959
2026-02-17T04:45:16.408954Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c5ffd-d51d-7a13-b1fa-342be02f164b
2026-02-17T04:45:16.488655Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c6275-d69e-7b53-bb28-583bfe07e70c
2026-02-17T04:45:16.572161Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c6946-d832-73b3-bade-761321c88a0a
2026-02-17T04:45:16.655069Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c5d40-288c-78b2-af66-36e0fae54073
2026-02-17T04:45:16.771249Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c6482-5bab-7e53-bc62-5239d048a3c8
2026-02-17T04:45:16.902071Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c6485-58f0-7261-8508-37f3fb9356dd
2026-02-17T04:45:16.939929Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c695b-193b-7040-9529-153a24848595
2026-02-17T04:45:17.087339Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c6031-b7fb-7120-85b5-8abf34324910
2026-02-17T04:45:17.206773Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c5fe2-872d-7e93-87a3-71d37d75a127
2026-02-17T04:45:17.318407Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c5e50-6bc5-7861-a0a0-f77d68ec073f
2026-02-17T04:45:17.418632Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c6022-8a12-7ba0-b7e8-9c265e8ec17e
2026-02-17T04:45:17.542684Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c5fbb-e145-7c40-9913-218548629e57
2026-02-17T04:45:17.652942Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c5e21-7a30-7ed1-b686-e02ac2da8157
2026-02-17T04:45:17.720608Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c647c-8066-7eb1-8782-06a844370303
2026-02-17T04:45:17.793911Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c5fed-5e04-78c0-9a4e-9fddc7af084e

thinking
**Announcing skill usage strategy**
codex
Implementing SEND-3 now: I‚Äôll locate every remaining `inngest.send()` in `src/inngest/functions`, apply `step.sendEvent()` with the same step IDs, then run TypeScript compile and confirm grep is clean. I‚Äôll also load the relevant Inngest skill guidance before editing.
exec
/bin/zsh -lc "cat /Users/joel/Code/joelhooks/joelclaw/.agents/skills/inngest-steps/SKILL.md | sed -n '1,220p'" in /private/tmp/agent-loop/loop-mlq3ts3f-tefwji/packages/system-bus succeeded in 51ms:
---
name: inngest-steps
description: Use Inngest step methods to build durable workflows. Covers step.run, step.sleep, step.waitForEvent, step.waitForSignal, step.sendEvent, step.invoke, step.ai, and patterns for loops and parallel execution.
---

# Inngest Steps

Build robust, durable workflows with Inngest's step methods. Each step is a separate HTTP request that can be independently retried and monitored.

> **These skills are focused on TypeScript.** For Python or Go, refer to the [Inngest documentation](https://www.inngest.com/llms.txt) for language-specific guidance. Core concepts apply across all languages.

## Core Concept

**üîÑ Critical: Each step re-runs your function from the beginning.** Put ALL non-deterministic code (API calls, DB queries, randomness) inside steps, never outside.

**üìä Step Limits:** Every function has a maximum of 1,000 steps and 4MB total step data.

```typescript
// ‚ùå WRONG - will run 4 times
export default inngest.createFunction(

thinking
**Searching skill use calls**
codex
Using the `inngest-steps` skill guidance here because this migration is specifically about durable `step.sendEvent()` usage patterns. I‚Äôm now scanning for all remaining `inngest.send` sites under `src/inngest/functions`.
exec
/bin/zsh -lc 'grep -r "inngest.send" src/inngest/functions/ --include="*.ts" | grep -v test' in /private/tmp/agent-loop/loop-mlq3ts3f-tefwji/packages/system-bus succeeded in 53ms:
src/inngest/functions/agent-loop/retro.ts:      await inngest.send({
src/inngest/functions/agent-loop/implement.ts:      await inngest.send({
src/inngest/functions/agent-loop/judge.ts:        await inngest.send({
src/inngest/functions/agent-loop/judge.ts:        await inngest.send({
src/inngest/functions/agent-loop/judge.ts:      await inngest.send({
src/inngest/functions/agent-loop/review.ts:      await inngest.send({
src/inngest/functions/agent-loop/plan.ts:        await inngest.send({
src/inngest/functions/agent-loop/plan.ts:        await inngest.send({
src/inngest/functions/agent-loop/plan.ts:      await inngest.send({
src/inngest/functions/summarize.ts:      await inngest.send({
src/inngest/functions/discovery-capture.ts:      await inngest.send({

thinking
**Planning parallel file reads**
exec
/bin/zsh -lc "sed -n '1,260p' src/inngest/functions/agent-loop/retro.ts" in /private/tmp/agent-loop/loop-mlq3ts3f-tefwji/packages/system-busexec
/bin/zsh -lc "sed -n '1,320p' src/inngest/functions/agent-loop/implement.ts" in /private/tmp/agent-loop/loop-mlq3ts3f-tefwji/packages/system-busexec
/bin/zsh -lc "sed -n '1,320p' src/inngest/functions/agent-loop/review.ts" in /private/tmp/agent-loop/loop-mlq3ts3f-tefwji/packages/system-busexec
/bin/zsh -lc "sed -n '1,360p' src/inngest/functions/agent-loop/judge.ts" in /private/tmp/agent-loop/loop-mlq3ts3f-tefwji/packages/system-bus succeeded in 51ms:
import { inngest } from "../../client";
import { readPrd, readProgress, writeRecommendations, ensureClaudeAuth } from "./utils";
import { mkdirSync } from "node:fs";
import { join } from "node:path";
import { $ } from "bun";

type StoryDetail = {
  id: string;
  title: string;
  passed: boolean;
  skipped: boolean;
  attempts: number;
  tool: string;
};

type ToolRanking = {
  tool: string;
  passRate: number;
  avgAttempts: number;
};
 succeeded in 52ms:
import { inngest } from "../../client";
import { $ } from "bun";
import {
  isCancelled,
  commitExists,
  commitMessage,
  gitCommit,
  outputPath,
  writePidFile,
  cleanupPid,
  parseToolOutput,
  TOOL_TIMEOUTS,
  hasUncommittedChanges,
  getHeadSha,
  isDockerAvailable,
  spawnInContainer,
  guardStory,
  renewLease,
  readLessons,
  readRecommendations,
 succeeded in 52ms:
import { inngest } from "../../client";
import {
  isCancelled,
  updateStoryPass,
  markStorySkipped,
  appendProgress,
  getStoryDiff,
  llmEvaluate,
  guardStory,
  releaseClaim,
  readPatterns,
} from "./utils";

const DEFAULT_RETRY_LADDER: ("codex" | "claude" | "pi")[] = [
  "codex",
  "claude",
  "codex",
];

function normalizeTestName(name: string): string {
 succeeded in 52ms:
import { inngest } from "../../client";
import { $ } from "bun";
import {
  isCancelled,
  writePidFile,
  cleanupPid,
  getStoryDiff,
  parseClaudeOutput,
  TOOL_TIMEOUTS,
  guardStory,
  renewLease,
  ensureClaudeAuth,
} from "./utils";
import { join } from "node:path";

const TEST_FILE_PATTERN = /(?:^|\/)\S+\.test\.[^/]+$/;

interface ReviewerQuestion {
  id: string;
  answer: boolean;

thinking
**Planning loading for discovery-capture**
codex
I found 11 remaining call sites across 7 files. I‚Äôm pulling the remaining files (`plan.ts`, `summarize.ts`, `discovery-capture.ts`) and then I‚Äôll patch all `inngest.send()` usages in one focused pass.
exec
/bin/zsh -lc "sed -n '1,360p' src/inngest/functions/agent-loop/plan.ts" in /private/tmp/agent-loop/loop-mlq3ts3f-tefwji/packages/system-busexec
/bin/zsh -lc "sed -n '1,260p' src/inngest/functions/discovery-capture.ts" in /private/tmp/agent-loop/loop-mlq3ts3f-tefwji/packages/system-busexec
/bin/zsh -lc "sed -n '1,260p' src/inngest/functions/summarize.ts" in /private/tmp/agent-loop/loop-mlq3ts3f-tefwji/packages/system-bus succeeded in 53ms:
import { inngest } from "../../client";
import { $ } from "bun";
import { join } from "node:path";
import { appendProgress, claimStory, isCancelled, readPrd, seedPrd, seedPrdFromData, markStoryRechecked, parseClaudeOutput, ensureClaudeAuth } from "./utils";

const DEFAULT_RETRY_LADDER = ["codex", "claude", "codex"] as const;

/**
 * Generate a PRD from a goal description + context files.
 * ADR-0012: Planner generates PRD.
 */
async function generatePrd(
  goal: string,
  project: string,
  contextPaths?: string[],
  maxStories: number = 6
): Promise<{ title: string; adr?: string; stories: any[] }> {
  // Read project structure
  let projectStructure = "";
  try {
 succeeded in 50ms:
import { inngest } from "../client";
import { $ } from "bun";

const DEFAULT_PROMPT = `Read the joel-writing-style skill at ~/.pi/agent/skills/joel-writing-style/SKILL.md first. All writing in this note MUST match Joel's voice ‚Äî conversational first person, short punchy paragraphs, strategic profanity where it earns its place, bold for emphasis, direct and honest tone. No corporate voice. No "In this video..." openings.

Read this vault note. Enrich it using your full tool set ‚Äî search the web for the speaker/author, the event/publication, projects and people mentioned, related work. Add hyperlinks to EVERYTHING that can be linked: people, companies, projects, conferences, papers, repos, related talks.

Edit the note in place. Replace the Executive Summary / Key Points sections (or the TODO placeholder) with:

## Executive Summary
2-3 paragraphs in Joel's voice. Core argument, significance, why it matters. Rich with context from your research. Write like you're telling a friend about it, not writing a book report.

## Key Points
- Bullet the main ideas. Each bullet should be self-contained and useful standalone.

## Speaker Context
Who is this person? Background, previous work, current role. Link to profiles, companies, projects.

## Notable Quotes
> Blockquoted memorable lines
 succeeded in 50ms:
import { inngest } from "../client";
import { $ } from "bun";
import { DISCOVERY_PROMPT } from "../prompts/discovery";

const VAULT_DISCOVERIES = `${process.env.HOME}/Vault/Resources/discoveries`;

/**
 * Discovery Capture ‚Äî investigates interesting finds and writes vault notes.
 *
 * Receives a URL and/or context. Does all the heavy lifting:
 * clone repos, extract articles, generate a compelling title,
 * decide tags/relevance, write vault note in Joel's voice, and slog.
 */
export const discoveryCapture = inngest.createFunction(
  {
    id: "discovery-capture",
    concurrency: { limit: 2 },
    retries: 1,
  },
  { event: "discovery/noted" },

thinking
**Locating exact call lines**
exec
/bin/zsh -lc "rg -n \"inngest\\.send|step\\.sendEvent\" src/inngest/functions/agent-loop/{retro.ts,implement.ts,judge.ts,review.ts,plan.ts} src/inngest/functions/{summarize.ts,discovery-capture.ts}" in /private/tmp/agent-loop/loop-mlq3ts3f-tefwji/packages/system-bus succeeded in 52ms:
src/inngest/functions/agent-loop/implement.ts:456:      await inngest.send({
src/inngest/functions/agent-loop/judge.ts:390:        await inngest.send({
src/inngest/functions/agent-loop/judge.ts:425:        await inngest.send({
src/inngest/functions/agent-loop/judge.ts:488:      await inngest.send({
src/inngest/functions/agent-loop/review.ts:393:      await inngest.send({
src/inngest/functions/summarize.ts:67:      await inngest.send({
src/inngest/functions/discovery-capture.ts:101:      await inngest.send({
src/inngest/functions/agent-loop/plan.ts:363:        await inngest.send({
src/inngest/functions/agent-loop/plan.ts:434:        await inngest.send({
src/inngest/functions/agent-loop/plan.ts:504:      await inngest.send({
src/inngest/functions/agent-loop/retro.ts:377:      await inngest.send({

thinking
**Planning step ID extraction**
codex
I‚Äôve narrowed exact line numbers. Next I‚Äôm editing each call site to `step.sendEvent()` and preserving each existing step ID wrapper unchanged.
exec
/bin/zsh -lc "sed -n '340,420p' src/inngest/functions/agent-loop/retro.ts" in /private/tmp/agent-loop/loop-mlq3ts3f-tefwji/packages/system-busexec
/bin/zsh -lc "sed -n '360,430p' src/inngest/functions/agent-loop/review.ts" in /private/tmp/agent-loop/loop-mlq3ts3f-tefwji/packages/system-busexec
/bin/zsh -lc "sed -n '360,520p' src/inngest/functions/agent-loop/judge.ts" in /private/tmp/agent-loop/loop-mlq3ts3f-tefwji/packages/system-busexec
/bin/zsh -lc "sed -n '330,530p' src/inngest/functions/agent-loop/plan.ts" in /private/tmp/agent-loop/loop-mlq3ts3f-tefwji/packages/system-busexec
/bin/zsh -lc "sed -n '52,95p' src/inngest/functions/summarize.ts" in /private/tmp/agent-loop/loop-mlq3ts3f-tefwji/packages/system-busexec
/bin/zsh -lc "sed -n '84,125p' src/inngest/functions/discovery-capture.ts" in /private/tmp/agent-loop/loop-mlq3ts3f-tefwji/packages/system-busexec
/bin/zsh -lc "sed -n '430,500p' src/inngest/functions/agent-loop/implement.ts" in /private/tmp/agent-loop/loop-mlq3ts3f-tefwji/packages/system-bus succeeded in 53ms:
      });
      // Append LLM reflection after mechanical summary
      const reflectionSection = reflection.analysis || reflection.narrative
        ? [
            "",
            "## Analysis",
            reflection.analysis || "_No analysis generated._",
            "",
            "## Narrative",
            reflection.narrative || "_No narrative generated._",
            "",
          ].join("\n")
        : "";
      await Bun.write(retroPath, mechanical + reflectionSection);
      return retroPath;
    });

    await step.run("write-planner-recommendations", async () => {
      const recommendations = buildRecommendations(storyDetails);
      const payload = {
 succeeded in 53ms:
        }

        // There are uncommitted changes ‚Äî make the harness commit
        const msg = commitMessage(loopId, storyId, attempt, story.title);
        const sha = await gitCommit(workDir, msg);
        await renewLease(loopId, storyId, runToken);
        return { blocked: false as const, sha };
      });
      if (commitResult.blocked) {
        return { status: "blocked", loopId, storyId, reason: commitResult.reason };
      }
      sha = commitResult.sha;
    }

    // Step 3: Determine reviewer tool (default: claude)
    const reviewerTool = "claude" as const;

    // Step 4: Emit review event
    const emitResult = await step.run("emit-review", async () => {
      const guard = await guardStory(loopId, storyId, runToken);
 succeeded in 53ms:

    // Step 3: Verify + slog
    await step.run("slog-result", async () => {
      const exists = await Bun.file(result.vaultPath).exists();
      if (!exists) {
        console.error(`Discovery note not written: ${result.vaultPath}`);
        return;
      }

      // Read title from the written file
      const content = await Bun.file(result.vaultPath).text();
      const titleMatch = content.match(/^# (.+)$/m);
      const title = titleMatch?.[1] ?? result.noteName;

      await $`slog write --action noted --tool discovery --detail "${title}" --reason "vault:Resources/discoveries/${result.noteName}.md"`.quiet();

      // Trigger sync to website
      await inngest.send({
        name: "discovery/captured",
        data: {
 succeeded in 53ms:
    });

    // Run pi in print mode ‚Äî it reads the file, researches, and edits in place
    await step.run("pi-enrich", async () => {
      // pi -p with @file reads the file content into context
      // pi with tools will use edit/write to modify the file directly
      await $`pi -p --no-session "Read the file at ${vaultPath} and enrich it. ${summaryPrompt}"`
        .env({ ...process.env, TERM: "dumb" })
        .quiet();
    });

    // Log + emit
    await step.run("log-and-emit", async () => {
      await $`slog write --action summarize --tool content-summarize --detail "enriched: ${title}" --reason "content/summarize event via inngest"`.quiet();

      await inngest.send({
        name: "content/summarized",
        data: { vaultPath, title },
      });
    });
 succeeded in 53ms:
        console.log(
          `[agent-loop-review] guard blocked evaluate-with-claude for ${storyId}: ${guard.reason}`
        );
        return { blocked: true as const, reason: guard.reason };
      }

      const prompt = buildEvaluationPrompt({ story, diff, testFiles });
      const questions = await evaluateQuestionsWithClaude(prompt, workDir, loopId);
      await renewLease(loopId, storyId, runToken);
      return { blocked: false as const, questions };
    });
    if (q2to4Result.blocked) {
      return { status: "blocked", loopId, storyId, reason: q2to4Result.reason };
    }
    const q2to4 = q2to4Result.questions;

    const reviewerNotes: ReviewerNotes = {
      questions: [q1, ...q2to4],
      testResults: results,
    };
 succeeded in 53ms:
        const diskPath = join(project, prdPath ?? "prd.json");
        await Bun.write(diskPath, JSON.stringify(generated, null, 2) + "\n");

        await appendProgress(loopId, [
          `## PRD Generated from Goal`,
          `Goal: ${goal}`,
          `Context: ${contextFiles?.join(", ") ?? "none"}`,
          `Stories: ${generated.stories.length}`,
          ...generated.stories.map((s: any) => `- ${s.id}: ${s.title}`),
        ].join("\n"));

        // Seed to Redis
        return seedPrdFromData(loopId, generated);
      }

      // Default: read from worktree disk
      return seedPrd(loopId, workDir, prdPath);
    });

    // Count attempted stories (passed + skipped) for maxIterations enforcement
 succeeded in 53ms:
        );
        return { status: "blocked", loopId, storyId, reason: writeGuard.reason };
      }

      // Update PRD (Redis + disk)
      await step.run("update-prd", async () => {
        await updateStoryPass(workDir, prdPath, storyId, loopId);
        return { storyId, action: "marked-passed" };
      });

      await step.run("append-progress", async () => {
        await appendProgress(loopId, [
          `**Story ${storyId}: ${story.title}** ‚Äî PASSED (attempt ${attempt})`,
          `- Tool: ${tool}`,
          `- Tests passed: ${testResults.testsPassed}`,
          `- Typecheck: ‚úÖ | Lint: ‚úÖ`,
        ].join("\n"));
        return { storyId, verdict: "pass", attempt, tool };
      });


thinking
**Planning global replacement**
codex
I‚Äôm now applying the code edits across the seven files, replacing `await inngest.send(...)` with `await step.sendEvent(...)` at each remaining site and leaving event payloads/step IDs intact.
exec
/bin/zsh -lc "perl -0pi -e 's/await inngest\\.send\\(/await step.sendEvent(/g' src/inngest/functions/agent-loop/retro.ts src/inngest/functions/agent-loop/implement.ts src/inngest/functions/agent-loop/judge.ts src/inngest/functions/agent-loop/review.ts src/inngest/functions/agent-loop/plan.ts src/inngest/functions/summarize.ts src/inngest/functions/discovery-capture.ts" in /private/tmp/agent-loop/loop-mlq3ts3f-tefwji/packages/system-bus succeeded in 53ms:


thinking
**Verifying grep results and build status**
exec
/bin/zsh -lc 'grep -r "inngest.send" src/inngest/functions/ --include="*.ts" | grep -v test' in /private/tmp/agent-loop/loop-mlq3ts3f-tefwji/packages/system-bus exited 1 in 53ms:


thinking
**Running TypeScript compilation**
codex
Edits are in; I‚Äôm validating against the acceptance gates now: grep zero-match check and `bunx tsc --noEmit`.
exec
/bin/zsh -lc 'bunx tsc --noEmit' in /private/tmp/agent-loop/loop-mlq3ts3f-tefwji/packages/system-bus exited 2 in 787ms:
src/inngest/functions/agent-loop/implement.ts(456,18): error TS2554: Expected 2 arguments, but got 1.
src/inngest/functions/agent-loop/judge.ts(390,20): error TS2554: Expected 2 arguments, but got 1.
src/inngest/functions/agent-loop/judge.ts(425,20): error TS2554: Expected 2 arguments, but got 1.
src/inngest/functions/agent-loop/judge.ts(488,18): error TS2554: Expected 2 arguments, but got 1.
src/inngest/functions/agent-loop/plan.ts(363,20): error TS2554: Expected 2 arguments, but got 1.
src/inngest/functions/agent-loop/plan.ts(434,20): error TS2554: Expected 2 arguments, but got 1.
src/inngest/functions/agent-loop/plan.ts(504,18): error TS2554: Expected 2 arguments, but got 1.
src/inngest/functions/agent-loop/retro.ts(377,18): error TS2554: Expected 2 arguments, but got 1.
src/inngest/functions/agent-loop/review.ts(393,18): error TS2554: Expected 2 arguments, but got 1.
src/inngest/functions/discovery-capture.ts(101,18): error TS2554: Expected 2 arguments, but got 1.
src/inngest/functions/summarize.ts(67,18): error TS2554: Expected 2 arguments, but got 1.

thinking
**Planning ID-based event refactor**
codex
TypeScript surfaced a signature mismatch: `step.sendEvent` in this codebase requires `(stepId, payload)`. I‚Äôm patching each site to pass the matching step ID explicitly (e.g. `"emit-review"`, `"emit-story-pass"`) and re-running compile.
file update
M /private/tmp/agent-loop/loop-mlq3ts3f-tefwji/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
@@ -376,3 +376,3 @@
     await step.run("emit-retro-complete", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-retro-complete", {
         name: "agent/loop.retro.completed",
apply_patch(auto_approved=true) exited 0 in 34ms:
Success. Updated the following files:
M src/inngest/functions/agent-loop/retro.ts
file update:
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
index 3c83c21fa02bea7559914ce931a4ae83017d6812..b1383bc362b8c02f742decdea75ccb011d8f9318
--- a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
@@ -374,7 +374,7 @@
     });
 
     await step.run("emit-retro-complete", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-retro-complete", {
         name: "agent/loop.retro.completed",
         data: {
           loopId,

file update:
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
index 3c83c21fa02bea7559914ce931a4ae83017d6812..b1383bc362b8c02f742decdea75ccb011d8f9318
--- a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
@@ -374,7 +374,7 @@
     });
 
     await step.run("emit-retro-complete", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-retro-complete", {
         name: "agent/loop.retro.completed",
         data: {
           loopId,


thinking
**Planning multi-file patch**
file update
M /private/tmp/agent-loop/loop-mlq3ts3f-tefwji/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
@@ -455,3 +455,3 @@
       }
-      await step.sendEvent({
+      await step.sendEvent("emit-review", {
         name: "agent/loop.code.committed",
apply_patch(auto_approved=true) exited 0 in 52ms:
Success. Updated the following files:
M src/inngest/functions/agent-loop/implement.ts
file update:
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/implement.ts b/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
index 801c2a13500bc20e5993ddaac429905c3bfb7436..e16733ef88a366fc24fdcc27ccd55a9983f80f12
--- a/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
@@ -453,7 +453,7 @@
         );
         return { blocked: true as const, reason: guard.reason };
       }
-      await step.sendEvent({
+      await step.sendEvent("emit-review", {
         name: "agent/loop.code.committed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
index 3c83c21fa02bea7559914ce931a4ae83017d6812..b1383bc362b8c02f742decdea75ccb011d8f9318
--- a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
@@ -374,7 +374,7 @@
     });
 
     await step.run("emit-retro-complete", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-retro-complete", {
         name: "agent/loop.retro.completed",
         data: {
           loopId,

file update:
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/implement.ts b/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
index 801c2a13500bc20e5993ddaac429905c3bfb7436..e16733ef88a366fc24fdcc27ccd55a9983f80f12
--- a/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
@@ -453,7 +453,7 @@
         );
         return { blocked: true as const, reason: guard.reason };
       }
-      await step.sendEvent({
+      await step.sendEvent("emit-review", {
         name: "agent/loop.code.committed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
index 3c83c21fa02bea7559914ce931a4ae83017d6812..b1383bc362b8c02f742decdea75ccb011d8f9318
--- a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
@@ -374,7 +374,7 @@
     });
 
     await step.run("emit-retro-complete", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-retro-complete", {
         name: "agent/loop.retro.completed",
         data: {
           loopId,

file update
M /private/tmp/agent-loop/loop-mlq3ts3f-tefwji/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
@@ -389,3 +389,3 @@
       await step.run("emit-story-pass", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-story-pass", {
           name: "agent/loop.story.passed",
@@ -424,3 +424,3 @@
       await step.run("emit-retry-implement", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-retry-implement", {
           name: "agent/loop.story.retried",
@@ -487,3 +487,3 @@
     await step.run("emit-story-fail", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-story-fail", {
         // ADR-0019: story.failed carries planner re-entry data (no separate plan emit)
apply_patch(auto_approved=true) exited 0 in 49ms:
Success. Updated the following files:
M src/inngest/functions/agent-loop/judge.ts
file update:
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/implement.ts b/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
index 801c2a13500bc20e5993ddaac429905c3bfb7436..e16733ef88a366fc24fdcc27ccd55a9983f80f12
--- a/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
@@ -453,7 +453,7 @@
         );
         return { blocked: true as const, reason: guard.reason };
       }
-      await step.sendEvent({
+      await step.sendEvent("emit-review", {
         name: "agent/loop.code.committed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/judge.ts b/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
index 19b349419cd56aae6bc622411abc5fa6ab197735..aaee63bf7d275fbf01920d502f487fd71f06afbd
--- a/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
@@ -387,7 +387,7 @@
 
       // ADR-0019: story.passed carries planner re-entry data (no separate plan emit)
       await step.run("emit-story-pass", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-story-pass", {
           name: "agent/loop.story.passed",
           data: {
             loopId,
@@ -422,7 +422,7 @@
 
       // ADR-0019: story.retried ‚Üí triggers implementor (skips test-writer on retry)
       await step.run("emit-retry-implement", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-retry-implement", {
           name: "agent/loop.story.retried",
           data: {
             loopId,
@@ -485,7 +485,7 @@
     // Emit story fail event with duration
     const failDurationMs = storyStartedAt ? Date.now() - storyStartedAt : 0;
     await step.run("emit-story-fail", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-story-fail", {
         // ADR-0019: story.failed carries planner re-entry data (no separate plan emit)
         name: "agent/loop.story.failed",
         data: {
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
index 3c83c21fa02bea7559914ce931a4ae83017d6812..b1383bc362b8c02f742decdea75ccb011d8f9318
--- a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
@@ -374,7 +374,7 @@
     });
 
     await step.run("emit-retro-complete", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-retro-complete", {
         name: "agent/loop.retro.completed",
         data: {
           loopId,

file update:
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/implement.ts b/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
index 801c2a13500bc20e5993ddaac429905c3bfb7436..e16733ef88a366fc24fdcc27ccd55a9983f80f12
--- a/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
@@ -453,7 +453,7 @@
         );
         return { blocked: true as const, reason: guard.reason };
       }
-      await step.sendEvent({
+      await step.sendEvent("emit-review", {
         name: "agent/loop.code.committed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/judge.ts b/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
index 19b349419cd56aae6bc622411abc5fa6ab197735..aaee63bf7d275fbf01920d502f487fd71f06afbd
--- a/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
@@ -387,7 +387,7 @@
 
       // ADR-0019: story.passed carries planner re-entry data (no separate plan emit)
       await step.run("emit-story-pass", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-story-pass", {
           name: "agent/loop.story.passed",
           data: {
             loopId,
@@ -422,7 +422,7 @@
 
       // ADR-0019: story.retried ‚Üí triggers implementor (skips test-writer on retry)
       await step.run("emit-retry-implement", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-retry-implement", {
           name: "agent/loop.story.retried",
           data: {
             loopId,
@@ -485,7 +485,7 @@
     // Emit story fail event with duration
     const failDurationMs = storyStartedAt ? Date.now() - storyStartedAt : 0;
     await step.run("emit-story-fail", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-story-fail", {
         // ADR-0019: story.failed carries planner re-entry data (no separate plan emit)
         name: "agent/loop.story.failed",
         data: {
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
index 3c83c21fa02bea7559914ce931a4ae83017d6812..b1383bc362b8c02f742decdea75ccb011d8f9318
--- a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
@@ -374,7 +374,7 @@
     });
 
     await step.run("emit-retro-complete", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-retro-complete", {
         name: "agent/loop.retro.completed",
         data: {
           loopId,

file update
M /private/tmp/agent-loop/loop-mlq3ts3f-tefwji/packages/system-bus/src/inngest/functions/agent-loop/review.ts
@@ -392,3 +392,3 @@
 
-      await step.sendEvent({
+      await step.sendEvent("emit-judge", {
         name: "agent/loop.checks.completed",
apply_patch(auto_approved=true) exited 0 in 55ms:
Success. Updated the following files:
M src/inngest/functions/agent-loop/review.ts
file update:
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/implement.ts b/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
index 801c2a13500bc20e5993ddaac429905c3bfb7436..e16733ef88a366fc24fdcc27ccd55a9983f80f12
--- a/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
@@ -453,7 +453,7 @@
         );
         return { blocked: true as const, reason: guard.reason };
       }
-      await step.sendEvent({
+      await step.sendEvent("emit-review", {
         name: "agent/loop.code.committed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/judge.ts b/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
index 19b349419cd56aae6bc622411abc5fa6ab197735..aaee63bf7d275fbf01920d502f487fd71f06afbd
--- a/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
@@ -387,7 +387,7 @@
 
       // ADR-0019: story.passed carries planner re-entry data (no separate plan emit)
       await step.run("emit-story-pass", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-story-pass", {
           name: "agent/loop.story.passed",
           data: {
             loopId,
@@ -422,7 +422,7 @@
 
       // ADR-0019: story.retried ‚Üí triggers implementor (skips test-writer on retry)
       await step.run("emit-retry-implement", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-retry-implement", {
           name: "agent/loop.story.retried",
           data: {
             loopId,
@@ -485,7 +485,7 @@
     // Emit story fail event with duration
     const failDurationMs = storyStartedAt ? Date.now() - storyStartedAt : 0;
     await step.run("emit-story-fail", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-story-fail", {
         // ADR-0019: story.failed carries planner re-entry data (no separate plan emit)
         name: "agent/loop.story.failed",
         data: {
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
index 3c83c21fa02bea7559914ce931a4ae83017d6812..b1383bc362b8c02f742decdea75ccb011d8f9318
--- a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
@@ -374,7 +374,7 @@
     });
 
     await step.run("emit-retro-complete", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-retro-complete", {
         name: "agent/loop.retro.completed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/review.ts b/packages/system-bus/src/inngest/functions/agent-loop/review.ts
index fdb3483ea6b09e8716907f517c7f1dfd03e8fd0f..bd4e2e3964c940d084eab65a9ed672274f846025
--- a/packages/system-bus/src/inngest/functions/agent-loop/review.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/review.ts
@@ -390,7 +390,7 @@
         return { blocked: true as const, reason: guard.reason };
       }
 
-      await step.sendEvent({
+      await step.sendEvent("emit-judge", {
         name: "agent/loop.checks.completed",
         data: {
           loopId,

file update:
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/implement.ts b/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
index 801c2a13500bc20e5993ddaac429905c3bfb7436..e16733ef88a366fc24fdcc27ccd55a9983f80f12
--- a/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
@@ -453,7 +453,7 @@
         );
         return { blocked: true as const, reason: guard.reason };
       }
-      await step.sendEvent({
+      await step.sendEvent("emit-review", {
         name: "agent/loop.code.committed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/judge.ts b/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
index 19b349419cd56aae6bc622411abc5fa6ab197735..aaee63bf7d275fbf01920d502f487fd71f06afbd
--- a/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
@@ -387,7 +387,7 @@
 
       // ADR-0019: story.passed carries planner re-entry data (no separate plan emit)
       await step.run("emit-story-pass", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-story-pass", {
           name: "agent/loop.story.passed",
           data: {
             loopId,
@@ -422,7 +422,7 @@
 
       // ADR-0019: story.retried ‚Üí triggers implementor (skips test-writer on retry)
       await step.run("emit-retry-implement", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-retry-implement", {
           name: "agent/loop.story.retried",
           data: {
             loopId,
@@ -485,7 +485,7 @@
     // Emit story fail event with duration
     const failDurationMs = storyStartedAt ? Date.now() - storyStartedAt : 0;
     await step.run("emit-story-fail", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-story-fail", {
         // ADR-0019: story.failed carries planner re-entry data (no separate plan emit)
         name: "agent/loop.story.failed",
         data: {
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
index 3c83c21fa02bea7559914ce931a4ae83017d6812..b1383bc362b8c02f742decdea75ccb011d8f9318
--- a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
@@ -374,7 +374,7 @@
     });
 
     await step.run("emit-retro-complete", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-retro-complete", {
         name: "agent/loop.retro.completed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/review.ts b/packages/system-bus/src/inngest/functions/agent-loop/review.ts
index fdb3483ea6b09e8716907f517c7f1dfd03e8fd0f..bd4e2e3964c940d084eab65a9ed672274f846025
--- a/packages/system-bus/src/inngest/functions/agent-loop/review.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/review.ts
@@ -390,7 +390,7 @@
         return { blocked: true as const, reason: guard.reason };
       }
 
-      await step.sendEvent({
+      await step.sendEvent("emit-judge", {
         name: "agent/loop.checks.completed",
         data: {
           loopId,

codex
I‚Äôve fixed four files and am finishing the remaining three (`plan.ts`, `summarize.ts`, `discovery-capture.ts`) with explicit step IDs in `step.sendEvent`.
file update
M /private/tmp/agent-loop/loop-mlq3ts3f-tefwji/packages/system-bus/src/inngest/functions/agent-loop/plan.ts
@@ -362,3 +362,3 @@
       await step.run("emit-complete-max-iterations", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-complete-max-iterations", {
           name: "agent/loop.completed",
@@ -433,3 +433,3 @@
       await step.run("emit-complete", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-complete", {
           name: "agent/loop.completed",
@@ -503,3 +503,3 @@
     await step.run("emit-test", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-test", {
         name: "agent/loop.story.dispatched",
apply_patch(auto_approved=true) exited 0 in 62ms:
Success. Updated the following files:
M src/inngest/functions/agent-loop/plan.ts
file update:
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/implement.ts b/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
index 801c2a13500bc20e5993ddaac429905c3bfb7436..e16733ef88a366fc24fdcc27ccd55a9983f80f12
--- a/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
@@ -453,7 +453,7 @@
         );
         return { blocked: true as const, reason: guard.reason };
       }
-      await step.sendEvent({
+      await step.sendEvent("emit-review", {
         name: "agent/loop.code.committed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/judge.ts b/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
index 19b349419cd56aae6bc622411abc5fa6ab197735..aaee63bf7d275fbf01920d502f487fd71f06afbd
--- a/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
@@ -387,7 +387,7 @@
 
       // ADR-0019: story.passed carries planner re-entry data (no separate plan emit)
       await step.run("emit-story-pass", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-story-pass", {
           name: "agent/loop.story.passed",
           data: {
             loopId,
@@ -422,7 +422,7 @@
 
       // ADR-0019: story.retried ‚Üí triggers implementor (skips test-writer on retry)
       await step.run("emit-retry-implement", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-retry-implement", {
           name: "agent/loop.story.retried",
           data: {
             loopId,
@@ -485,7 +485,7 @@
     // Emit story fail event with duration
     const failDurationMs = storyStartedAt ? Date.now() - storyStartedAt : 0;
     await step.run("emit-story-fail", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-story-fail", {
         // ADR-0019: story.failed carries planner re-entry data (no separate plan emit)
         name: "agent/loop.story.failed",
         data: {
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/plan.ts b/packages/system-bus/src/inngest/functions/agent-loop/plan.ts
index 82b4fbd4108c89eeaaffe13a06e64031fce87157..1d66996b6cbd38e5bd28fa2415873e4ade170d52
--- a/packages/system-bus/src/inngest/functions/agent-loop/plan.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/plan.ts
@@ -360,7 +360,7 @@
       const completed = prd.stories.filter((s) => s.passes).length;
       const skipped = prd.stories.filter((s) => (s as any).skipped).length;
       await step.run("emit-complete-max-iterations", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-complete-max-iterations", {
           name: "agent/loop.completed",
           data: {
             loopId,
@@ -431,7 +431,7 @@
       ).length;
 
       await step.run("emit-complete", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-complete", {
           name: "agent/loop.completed",
           data: {
             loopId,
@@ -501,7 +501,7 @@
     }
 
     await step.run("emit-test", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-test", {
         name: "agent/loop.story.dispatched",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
index 3c83c21fa02bea7559914ce931a4ae83017d6812..b1383bc362b8c02f742decdea75ccb011d8f9318
--- a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
@@ -374,7 +374,7 @@
     });
 
     await step.run("emit-retro-complete", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-retro-complete", {
         name: "agent/loop.retro.completed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/review.ts b/packages/system-bus/src/inngest/functions/agent-loop/review.ts
index fdb3483ea6b09e8716907f517c7f1dfd03e8fd0f..bd4e2e3964c940d084eab65a9ed672274f846025
--- a/packages/system-bus/src/inngest/functions/agent-loop/review.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/review.ts
@@ -390,7 +390,7 @@
         return { blocked: true as const, reason: guard.reason };
       }
 
-      await step.sendEvent({
+      await step.sendEvent("emit-judge", {
         name: "agent/loop.checks.completed",
         data: {
           loopId,

file update:
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/implement.ts b/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
index 801c2a13500bc20e5993ddaac429905c3bfb7436..e16733ef88a366fc24fdcc27ccd55a9983f80f12
--- a/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
@@ -453,7 +453,7 @@
         );
         return { blocked: true as const, reason: guard.reason };
       }
-      await step.sendEvent({
+      await step.sendEvent("emit-review", {
         name: "agent/loop.code.committed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/judge.ts b/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
index 19b349419cd56aae6bc622411abc5fa6ab197735..aaee63bf7d275fbf01920d502f487fd71f06afbd
--- a/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
@@ -387,7 +387,7 @@
 
       // ADR-0019: story.passed carries planner re-entry data (no separate plan emit)
       await step.run("emit-story-pass", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-story-pass", {
           name: "agent/loop.story.passed",
           data: {
             loopId,
@@ -422,7 +422,7 @@
 
       // ADR-0019: story.retried ‚Üí triggers implementor (skips test-writer on retry)
       await step.run("emit-retry-implement", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-retry-implement", {
           name: "agent/loop.story.retried",
           data: {
             loopId,
@@ -485,7 +485,7 @@
     // Emit story fail event with duration
     const failDurationMs = storyStartedAt ? Date.now() - storyStartedAt : 0;
     await step.run("emit-story-fail", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-story-fail", {
         // ADR-0019: story.failed carries planner re-entry data (no separate plan emit)
         name: "agent/loop.story.failed",
         data: {
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/plan.ts b/packages/system-bus/src/inngest/functions/agent-loop/plan.ts
index 82b4fbd4108c89eeaaffe13a06e64031fce87157..1d66996b6cbd38e5bd28fa2415873e4ade170d52
--- a/packages/system-bus/src/inngest/functions/agent-loop/plan.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/plan.ts
@@ -360,7 +360,7 @@
       const completed = prd.stories.filter((s) => s.passes).length;
       const skipped = prd.stories.filter((s) => (s as any).skipped).length;
       await step.run("emit-complete-max-iterations", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-complete-max-iterations", {
           name: "agent/loop.completed",
           data: {
             loopId,
@@ -431,7 +431,7 @@
       ).length;
 
       await step.run("emit-complete", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-complete", {
           name: "agent/loop.completed",
           data: {
             loopId,
@@ -501,7 +501,7 @@
     }
 
     await step.run("emit-test", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-test", {
         name: "agent/loop.story.dispatched",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
index 3c83c21fa02bea7559914ce931a4ae83017d6812..b1383bc362b8c02f742decdea75ccb011d8f9318
--- a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
@@ -374,7 +374,7 @@
     });
 
     await step.run("emit-retro-complete", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-retro-complete", {
         name: "agent/loop.retro.completed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/review.ts b/packages/system-bus/src/inngest/functions/agent-loop/review.ts
index fdb3483ea6b09e8716907f517c7f1dfd03e8fd0f..bd4e2e3964c940d084eab65a9ed672274f846025
--- a/packages/system-bus/src/inngest/functions/agent-loop/review.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/review.ts
@@ -390,7 +390,7 @@
         return { blocked: true as const, reason: guard.reason };
       }
 
-      await step.sendEvent({
+      await step.sendEvent("emit-judge", {
         name: "agent/loop.checks.completed",
         data: {
           loopId,

file update
M /private/tmp/agent-loop/loop-mlq3ts3f-tefwji/packages/system-bus/src/inngest/functions/summarize.ts
@@ -66,3 +66,3 @@
 
-      await step.sendEvent({
+      await step.sendEvent("log-and-emit", {
         name: "content/summarized",
apply_patch(auto_approved=true) exited 0 in 69ms:
Success. Updated the following files:
M src/inngest/functions/summarize.ts
file update:
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/implement.ts b/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
index 801c2a13500bc20e5993ddaac429905c3bfb7436..e16733ef88a366fc24fdcc27ccd55a9983f80f12
--- a/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
@@ -453,7 +453,7 @@
         );
         return { blocked: true as const, reason: guard.reason };
       }
-      await step.sendEvent({
+      await step.sendEvent("emit-review", {
         name: "agent/loop.code.committed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/judge.ts b/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
index 19b349419cd56aae6bc622411abc5fa6ab197735..aaee63bf7d275fbf01920d502f487fd71f06afbd
--- a/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
@@ -387,7 +387,7 @@
 
       // ADR-0019: story.passed carries planner re-entry data (no separate plan emit)
       await step.run("emit-story-pass", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-story-pass", {
           name: "agent/loop.story.passed",
           data: {
             loopId,
@@ -422,7 +422,7 @@
 
       // ADR-0019: story.retried ‚Üí triggers implementor (skips test-writer on retry)
       await step.run("emit-retry-implement", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-retry-implement", {
           name: "agent/loop.story.retried",
           data: {
             loopId,
@@ -485,7 +485,7 @@
     // Emit story fail event with duration
     const failDurationMs = storyStartedAt ? Date.now() - storyStartedAt : 0;
     await step.run("emit-story-fail", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-story-fail", {
         // ADR-0019: story.failed carries planner re-entry data (no separate plan emit)
         name: "agent/loop.story.failed",
         data: {
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/plan.ts b/packages/system-bus/src/inngest/functions/agent-loop/plan.ts
index 82b4fbd4108c89eeaaffe13a06e64031fce87157..1d66996b6cbd38e5bd28fa2415873e4ade170d52
--- a/packages/system-bus/src/inngest/functions/agent-loop/plan.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/plan.ts
@@ -360,7 +360,7 @@
       const completed = prd.stories.filter((s) => s.passes).length;
       const skipped = prd.stories.filter((s) => (s as any).skipped).length;
       await step.run("emit-complete-max-iterations", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-complete-max-iterations", {
           name: "agent/loop.completed",
           data: {
             loopId,
@@ -431,7 +431,7 @@
       ).length;
 
       await step.run("emit-complete", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-complete", {
           name: "agent/loop.completed",
           data: {
             loopId,
@@ -501,7 +501,7 @@
     }
 
     await step.run("emit-test", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-test", {
         name: "agent/loop.story.dispatched",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
index 3c83c21fa02bea7559914ce931a4ae83017d6812..b1383bc362b8c02f742decdea75ccb011d8f9318
--- a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
@@ -374,7 +374,7 @@
     });
 
     await step.run("emit-retro-complete", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-retro-complete", {
         name: "agent/loop.retro.completed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/review.ts b/packages/system-bus/src/inngest/functions/agent-loop/review.ts
index fdb3483ea6b09e8716907f517c7f1dfd03e8fd0f..bd4e2e3964c940d084eab65a9ed672274f846025
--- a/packages/system-bus/src/inngest/functions/agent-loop/review.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/review.ts
@@ -390,7 +390,7 @@
         return { blocked: true as const, reason: guard.reason };
       }
 
-      await step.sendEvent({
+      await step.sendEvent("emit-judge", {
         name: "agent/loop.checks.completed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/summarize.ts b/packages/system-bus/src/inngest/functions/summarize.ts
index e7d74e16a955bc29d0232d7e00938712f12f6eda..471957ca09e7942a1f8337f8784e899f1dc99bf2
--- a/packages/system-bus/src/inngest/functions/summarize.ts
+++ b/packages/system-bus/src/inngest/functions/summarize.ts
@@ -64,7 +64,7 @@
     await step.run("log-and-emit", async () => {
       await $`slog write --action summarize --tool content-summarize --detail "enriched: ${title}" --reason "content/summarize event via inngest"`.quiet();
 
-      await step.sendEvent({
+      await step.sendEvent("log-and-emit", {
         name: "content/summarized",
         data: { vaultPath, title },
       });

file update:
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/implement.ts b/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
index 801c2a13500bc20e5993ddaac429905c3bfb7436..e16733ef88a366fc24fdcc27ccd55a9983f80f12
--- a/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
@@ -453,7 +453,7 @@
         );
         return { blocked: true as const, reason: guard.reason };
       }
-      await step.sendEvent({
+      await step.sendEvent("emit-review", {
         name: "agent/loop.code.committed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/judge.ts b/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
index 19b349419cd56aae6bc622411abc5fa6ab197735..aaee63bf7d275fbf01920d502f487fd71f06afbd
--- a/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
@@ -387,7 +387,7 @@
 
       // ADR-0019: story.passed carries planner re-entry data (no separate plan emit)
       await step.run("emit-story-pass", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-story-pass", {
           name: "agent/loop.story.passed",
           data: {
             loopId,
@@ -422,7 +422,7 @@
 
       // ADR-0019: story.retried ‚Üí triggers implementor (skips test-writer on retry)
       await step.run("emit-retry-implement", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-retry-implement", {
           name: "agent/loop.story.retried",
           data: {
             loopId,
@@ -485,7 +485,7 @@
     // Emit story fail event with duration
     const failDurationMs = storyStartedAt ? Date.now() - storyStartedAt : 0;
     await step.run("emit-story-fail", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-story-fail", {
         // ADR-0019: story.failed carries planner re-entry data (no separate plan emit)
         name: "agent/loop.story.failed",
         data: {
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/plan.ts b/packages/system-bus/src/inngest/functions/agent-loop/plan.ts
index 82b4fbd4108c89eeaaffe13a06e64031fce87157..1d66996b6cbd38e5bd28fa2415873e4ade170d52
--- a/packages/system-bus/src/inngest/functions/agent-loop/plan.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/plan.ts
@@ -360,7 +360,7 @@
       const completed = prd.stories.filter((s) => s.passes).length;
       const skipped = prd.stories.filter((s) => (s as any).skipped).length;
       await step.run("emit-complete-max-iterations", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-complete-max-iterations", {
           name: "agent/loop.completed",
           data: {
             loopId,
@@ -431,7 +431,7 @@
       ).length;
 
       await step.run("emit-complete", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-complete", {
           name: "agent/loop.completed",
           data: {
             loopId,
@@ -501,7 +501,7 @@
     }
 
     await step.run("emit-test", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-test", {
         name: "agent/loop.story.dispatched",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
index 3c83c21fa02bea7559914ce931a4ae83017d6812..b1383bc362b8c02f742decdea75ccb011d8f9318
--- a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
@@ -374,7 +374,7 @@
     });
 
     await step.run("emit-retro-complete", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-retro-complete", {
         name: "agent/loop.retro.completed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/review.ts b/packages/system-bus/src/inngest/functions/agent-loop/review.ts
index fdb3483ea6b09e8716907f517c7f1dfd03e8fd0f..bd4e2e3964c940d084eab65a9ed672274f846025
--- a/packages/system-bus/src/inngest/functions/agent-loop/review.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/review.ts
@@ -390,7 +390,7 @@
         return { blocked: true as const, reason: guard.reason };
       }
 
-      await step.sendEvent({
+      await step.sendEvent("emit-judge", {
         name: "agent/loop.checks.completed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/summarize.ts b/packages/system-bus/src/inngest/functions/summarize.ts
index e7d74e16a955bc29d0232d7e00938712f12f6eda..471957ca09e7942a1f8337f8784e899f1dc99bf2
--- a/packages/system-bus/src/inngest/functions/summarize.ts
+++ b/packages/system-bus/src/inngest/functions/summarize.ts
@@ -64,7 +64,7 @@
     await step.run("log-and-emit", async () => {
       await $`slog write --action summarize --tool content-summarize --detail "enriched: ${title}" --reason "content/summarize event via inngest"`.quiet();
 
-      await step.sendEvent({
+      await step.sendEvent("log-and-emit", {
         name: "content/summarized",
         data: { vaultPath, title },
       });

file update
M /private/tmp/agent-loop/loop-mlq3ts3f-tefwji/packages/system-bus/src/inngest/functions/discovery-capture.ts
@@ -100,3 +100,3 @@
       // Trigger sync to website
-      await step.sendEvent({
+      await step.sendEvent("slog-result", {
         name: "discovery/captured",
apply_patch(auto_approved=true) exited 0 in 79ms:
Success. Updated the following files:
M src/inngest/functions/discovery-capture.ts
file update:
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/implement.ts b/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
index 801c2a13500bc20e5993ddaac429905c3bfb7436..e16733ef88a366fc24fdcc27ccd55a9983f80f12
--- a/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
@@ -453,7 +453,7 @@
         );
         return { blocked: true as const, reason: guard.reason };
       }
-      await step.sendEvent({
+      await step.sendEvent("emit-review", {
         name: "agent/loop.code.committed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/judge.ts b/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
index 19b349419cd56aae6bc622411abc5fa6ab197735..aaee63bf7d275fbf01920d502f487fd71f06afbd
--- a/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
@@ -387,7 +387,7 @@
 
       // ADR-0019: story.passed carries planner re-entry data (no separate plan emit)
       await step.run("emit-story-pass", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-story-pass", {
           name: "agent/loop.story.passed",
           data: {
             loopId,
@@ -422,7 +422,7 @@
 
       // ADR-0019: story.retried ‚Üí triggers implementor (skips test-writer on retry)
       await step.run("emit-retry-implement", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-retry-implement", {
           name: "agent/loop.story.retried",
           data: {
             loopId,
@@ -485,7 +485,7 @@
     // Emit story fail event with duration
     const failDurationMs = storyStartedAt ? Date.now() - storyStartedAt : 0;
     await step.run("emit-story-fail", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-story-fail", {
         // ADR-0019: story.failed carries planner re-entry data (no separate plan emit)
         name: "agent/loop.story.failed",
         data: {
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/plan.ts b/packages/system-bus/src/inngest/functions/agent-loop/plan.ts
index 82b4fbd4108c89eeaaffe13a06e64031fce87157..1d66996b6cbd38e5bd28fa2415873e4ade170d52
--- a/packages/system-bus/src/inngest/functions/agent-loop/plan.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/plan.ts
@@ -360,7 +360,7 @@
       const completed = prd.stories.filter((s) => s.passes).length;
       const skipped = prd.stories.filter((s) => (s as any).skipped).length;
       await step.run("emit-complete-max-iterations", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-complete-max-iterations", {
           name: "agent/loop.completed",
           data: {
             loopId,
@@ -431,7 +431,7 @@
       ).length;
 
       await step.run("emit-complete", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-complete", {
           name: "agent/loop.completed",
           data: {
             loopId,
@@ -501,7 +501,7 @@
     }
 
     await step.run("emit-test", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-test", {
         name: "agent/loop.story.dispatched",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
index 3c83c21fa02bea7559914ce931a4ae83017d6812..b1383bc362b8c02f742decdea75ccb011d8f9318
--- a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
@@ -374,7 +374,7 @@
     });
 
     await step.run("emit-retro-complete", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-retro-complete", {
         name: "agent/loop.retro.completed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/review.ts b/packages/system-bus/src/inngest/functions/agent-loop/review.ts
index fdb3483ea6b09e8716907f517c7f1dfd03e8fd0f..bd4e2e3964c940d084eab65a9ed672274f846025
--- a/packages/system-bus/src/inngest/functions/agent-loop/review.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/review.ts
@@ -390,7 +390,7 @@
         return { blocked: true as const, reason: guard.reason };
       }
 
-      await step.sendEvent({
+      await step.sendEvent("emit-judge", {
         name: "agent/loop.checks.completed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/discovery-capture.ts b/packages/system-bus/src/inngest/functions/discovery-capture.ts
index 3242046b575b6624332261d736254e0546453729..029242aa4918d4b4e01cef37893c37aaeba83098
--- a/packages/system-bus/src/inngest/functions/discovery-capture.ts
+++ b/packages/system-bus/src/inngest/functions/discovery-capture.ts
@@ -98,7 +98,7 @@
       await $`slog write --action noted --tool discovery --detail "${title}" --reason "vault:Resources/discoveries/${result.noteName}.md"`.quiet();
 
       // Trigger sync to website
-      await step.sendEvent({
+      await step.sendEvent("slog-result", {
         name: "discovery/captured",
         data: {
           vaultPath: result.vaultPath,
diff --git a/packages/system-bus/src/inngest/functions/summarize.ts b/packages/system-bus/src/inngest/functions/summarize.ts
index e7d74e16a955bc29d0232d7e00938712f12f6eda..471957ca09e7942a1f8337f8784e899f1dc99bf2
--- a/packages/system-bus/src/inngest/functions/summarize.ts
+++ b/packages/system-bus/src/inngest/functions/summarize.ts
@@ -64,7 +64,7 @@
     await step.run("log-and-emit", async () => {
       await $`slog write --action summarize --tool content-summarize --detail "enriched: ${title}" --reason "content/summarize event via inngest"`.quiet();
 
-      await step.sendEvent({
+      await step.sendEvent("log-and-emit", {
         name: "content/summarized",
         data: { vaultPath, title },
       });

file update:
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/implement.ts b/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
index 801c2a13500bc20e5993ddaac429905c3bfb7436..e16733ef88a366fc24fdcc27ccd55a9983f80f12
--- a/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
@@ -453,7 +453,7 @@
         );
         return { blocked: true as const, reason: guard.reason };
       }
-      await step.sendEvent({
+      await step.sendEvent("emit-review", {
         name: "agent/loop.code.committed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/judge.ts b/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
index 19b349419cd56aae6bc622411abc5fa6ab197735..aaee63bf7d275fbf01920d502f487fd71f06afbd
--- a/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
@@ -387,7 +387,7 @@
 
       // ADR-0019: story.passed carries planner re-entry data (no separate plan emit)
       await step.run("emit-story-pass", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-story-pass", {
           name: "agent/loop.story.passed",
           data: {
             loopId,
@@ -422,7 +422,7 @@
 
       // ADR-0019: story.retried ‚Üí triggers implementor (skips test-writer on retry)
       await step.run("emit-retry-implement", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-retry-implement", {
           name: "agent/loop.story.retried",
           data: {
             loopId,
@@ -485,7 +485,7 @@
     // Emit story fail event with duration
     const failDurationMs = storyStartedAt ? Date.now() - storyStartedAt : 0;
     await step.run("emit-story-fail", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-story-fail", {
         // ADR-0019: story.failed carries planner re-entry data (no separate plan emit)
         name: "agent/loop.story.failed",
         data: {
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/plan.ts b/packages/system-bus/src/inngest/functions/agent-loop/plan.ts
index 82b4fbd4108c89eeaaffe13a06e64031fce87157..1d66996b6cbd38e5bd28fa2415873e4ade170d52
--- a/packages/system-bus/src/inngest/functions/agent-loop/plan.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/plan.ts
@@ -360,7 +360,7 @@
       const completed = prd.stories.filter((s) => s.passes).length;
       const skipped = prd.stories.filter((s) => (s as any).skipped).length;
       await step.run("emit-complete-max-iterations", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-complete-max-iterations", {
           name: "agent/loop.completed",
           data: {
             loopId,
@@ -431,7 +431,7 @@
       ).length;
 
       await step.run("emit-complete", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-complete", {
           name: "agent/loop.completed",
           data: {
             loopId,
@@ -501,7 +501,7 @@
     }
 
     await step.run("emit-test", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-test", {
         name: "agent/loop.story.dispatched",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
index 3c83c21fa02bea7559914ce931a4ae83017d6812..b1383bc362b8c02f742decdea75ccb011d8f9318
--- a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
@@ -374,7 +374,7 @@
     });
 
     await step.run("emit-retro-complete", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-retro-complete", {
         name: "agent/loop.retro.completed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/review.ts b/packages/system-bus/src/inngest/functions/agent-loop/review.ts
index fdb3483ea6b09e8716907f517c7f1dfd03e8fd0f..bd4e2e3964c940d084eab65a9ed672274f846025
--- a/packages/system-bus/src/inngest/functions/agent-loop/review.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/review.ts
@@ -390,7 +390,7 @@
         return { blocked: true as const, reason: guard.reason };
       }
 
-      await step.sendEvent({
+      await step.sendEvent("emit-judge", {
         name: "agent/loop.checks.completed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/discovery-capture.ts b/packages/system-bus/src/inngest/functions/discovery-capture.ts
index 3242046b575b6624332261d736254e0546453729..029242aa4918d4b4e01cef37893c37aaeba83098
--- a/packages/system-bus/src/inngest/functions/discovery-capture.ts
+++ b/packages/system-bus/src/inngest/functions/discovery-capture.ts
@@ -98,7 +98,7 @@
       await $`slog write --action noted --tool discovery --detail "${title}" --reason "vault:Resources/discoveries/${result.noteName}.md"`.quiet();
 
       // Trigger sync to website
-      await step.sendEvent({
+      await step.sendEvent("slog-result", {
         name: "discovery/captured",
         data: {
           vaultPath: result.vaultPath,
diff --git a/packages/system-bus/src/inngest/functions/summarize.ts b/packages/system-bus/src/inngest/functions/summarize.ts
index e7d74e16a955bc29d0232d7e00938712f12f6eda..471957ca09e7942a1f8337f8784e899f1dc99bf2
--- a/packages/system-bus/src/inngest/functions/summarize.ts
+++ b/packages/system-bus/src/inngest/functions/summarize.ts
@@ -64,7 +64,7 @@
     await step.run("log-and-emit", async () => {
       await $`slog write --action summarize --tool content-summarize --detail "enriched: ${title}" --reason "content/summarize event via inngest"`.quiet();
 
-      await step.sendEvent({
+      await step.sendEvent("log-and-emit", {
         name: "content/summarized",
         data: { vaultPath, title },
       });


thinking
**Planning parallel command execution**
exec
/bin/zsh -lc 'grep -r "inngest.send" src/inngest/functions/ --include="*.ts" | grep -v test' in /private/tmp/agent-loop/loop-mlq3ts3f-tefwji/packages/system-bus exited 1 in 53ms:

exec
/bin/zsh -lc 'bunx tsc --noEmit' in /private/tmp/agent-loop/loop-mlq3ts3f-tefwji/packages/system-bus succeeded in 779ms:

file update:
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/implement.ts b/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
index 801c2a13500bc20e5993ddaac429905c3bfb7436..e16733ef88a366fc24fdcc27ccd55a9983f80f12
--- a/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
@@ -453,7 +453,7 @@
         );
         return { blocked: true as const, reason: guard.reason };
       }
-      await step.sendEvent({
+      await step.sendEvent("emit-review", {
         name: "agent/loop.code.committed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/judge.ts b/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
index 19b349419cd56aae6bc622411abc5fa6ab197735..aaee63bf7d275fbf01920d502f487fd71f06afbd
--- a/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
@@ -387,7 +387,7 @@
 
       // ADR-0019: story.passed carries planner re-entry data (no separate plan emit)
       await step.run("emit-story-pass", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-story-pass", {
           name: "agent/loop.story.passed",
           data: {
             loopId,
@@ -422,7 +422,7 @@
 
       // ADR-0019: story.retried ‚Üí triggers implementor (skips test-writer on retry)
       await step.run("emit-retry-implement", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-retry-implement", {
           name: "agent/loop.story.retried",
           data: {
             loopId,
@@ -485,7 +485,7 @@
     // Emit story fail event with duration
     const failDurationMs = storyStartedAt ? Date.now() - storyStartedAt : 0;
     await step.run("emit-story-fail", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-story-fail", {
         // ADR-0019: story.failed carries planner re-entry data (no separate plan emit)
         name: "agent/loop.story.failed",
         data: {
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/plan.ts b/packages/system-bus/src/inngest/functions/agent-loop/plan.ts
index 82b4fbd4108c89eeaaffe13a06e64031fce87157..1d66996b6cbd38e5bd28fa2415873e4ade170d52
--- a/packages/system-bus/src/inngest/functions/agent-loop/plan.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/plan.ts
@@ -360,7 +360,7 @@
       const completed = prd.stories.filter((s) => s.passes).length;
       const skipped = prd.stories.filter((s) => (s as any).skipped).length;
       await step.run("emit-complete-max-iterations", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-complete-max-iterations", {
           name: "agent/loop.completed",
           data: {
             loopId,
@@ -431,7 +431,7 @@
       ).length;
 
       await step.run("emit-complete", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-complete", {
           name: "agent/loop.completed",
           data: {
             loopId,
@@ -501,7 +501,7 @@
     }
 
     await step.run("emit-test", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-test", {
         name: "agent/loop.story.dispatched",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
index 3c83c21fa02bea7559914ce931a4ae83017d6812..b1383bc362b8c02f742decdea75ccb011d8f9318
--- a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
@@ -374,7 +374,7 @@
     });
 
     await step.run("emit-retro-complete", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-retro-complete", {
         name: "agent/loop.retro.completed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/review.ts b/packages/system-bus/src/inngest/functions/agent-loop/review.ts
index fdb3483ea6b09e8716907f517c7f1dfd03e8fd0f..bd4e2e3964c940d084eab65a9ed672274f846025
--- a/packages/system-bus/src/inngest/functions/agent-loop/review.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/review.ts
@@ -390,7 +390,7 @@
         return { blocked: true as const, reason: guard.reason };
       }
 
-      await step.sendEvent({
+      await step.sendEvent("emit-judge", {
         name: "agent/loop.checks.completed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/discovery-capture.ts b/packages/system-bus/src/inngest/functions/discovery-capture.ts
index 3242046b575b6624332261d736254e0546453729..029242aa4918d4b4e01cef37893c37aaeba83098
--- a/packages/system-bus/src/inngest/functions/discovery-capture.ts
+++ b/packages/system-bus/src/inngest/functions/discovery-capture.ts
@@ -98,7 +98,7 @@
       await $`slog write --action noted --tool discovery --detail "${title}" --reason "vault:Resources/discoveries/${result.noteName}.md"`.quiet();
 
       // Trigger sync to website
-      await step.sendEvent({
+      await step.sendEvent("slog-result", {
         name: "discovery/captured",
         data: {
           vaultPath: result.vaultPath,
diff --git a/packages/system-bus/src/inngest/functions/summarize.ts b/packages/system-bus/src/inngest/functions/summarize.ts
index e7d74e16a955bc29d0232d7e00938712f12f6eda..471957ca09e7942a1f8337f8784e899f1dc99bf2
--- a/packages/system-bus/src/inngest/functions/summarize.ts
+++ b/packages/system-bus/src/inngest/functions/summarize.ts
@@ -64,7 +64,7 @@
     await step.run("log-and-emit", async () => {
       await $`slog write --action summarize --tool content-summarize --detail "enriched: ${title}" --reason "content/summarize event via inngest"`.quiet();
 
-      await step.sendEvent({
+      await step.sendEvent("log-and-emit", {
         name: "content/summarized",
         data: { vaultPath, title },
       });


thinking
**Checking for event-related changes**
exec
/bin/zsh -lc "rg -n \"step\\.sendEvent\\(\" src/inngest/functions/agent-loop/{retro.ts,implement.ts,judge.ts,review.ts,plan.ts} src/inngest/functions/{summarize.ts,discovery-capture.ts}" in /private/tmp/agent-loop/loop-mlq3ts3f-tefwji/packages/system-bus succeeded in 51ms:
src/inngest/functions/agent-loop/retro.ts:377:      await step.sendEvent("emit-retro-complete", {
src/inngest/functions/agent-loop/implement.ts:456:      await step.sendEvent("emit-review", {
src/inngest/functions/agent-loop/judge.ts:390:        await step.sendEvent("emit-story-pass", {
src/inngest/functions/agent-loop/judge.ts:425:        await step.sendEvent("emit-retry-implement", {
src/inngest/functions/agent-loop/judge.ts:488:      await step.sendEvent("emit-story-fail", {
src/inngest/functions/agent-loop/review.ts:393:      await step.sendEvent("emit-judge", {
src/inngest/functions/summarize.ts:67:      await step.sendEvent("log-and-emit", {
src/inngest/functions/discovery-capture.ts:101:      await step.sendEvent("slog-result", {
src/inngest/functions/agent-loop/plan.ts:363:        await step.sendEvent("emit-complete-max-iterations", {
src/inngest/functions/agent-loop/plan.ts:434:        await step.sendEvent("emit-complete", {
src/inngest/functions/agent-loop/plan.ts:504:      await step.sendEvent("emit-test", {
file update:
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/implement.ts b/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
index 801c2a13500bc20e5993ddaac429905c3bfb7436..e16733ef88a366fc24fdcc27ccd55a9983f80f12
--- a/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
@@ -453,7 +453,7 @@
         );
         return { blocked: true as const, reason: guard.reason };
       }
-      await step.sendEvent({
+      await step.sendEvent("emit-review", {
         name: "agent/loop.code.committed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/judge.ts b/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
index 19b349419cd56aae6bc622411abc5fa6ab197735..aaee63bf7d275fbf01920d502f487fd71f06afbd
--- a/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
@@ -387,7 +387,7 @@
 
       // ADR-0019: story.passed carries planner re-entry data (no separate plan emit)
       await step.run("emit-story-pass", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-story-pass", {
           name: "agent/loop.story.passed",
           data: {
             loopId,
@@ -422,7 +422,7 @@
 
       // ADR-0019: story.retried ‚Üí triggers implementor (skips test-writer on retry)
       await step.run("emit-retry-implement", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-retry-implement", {
           name: "agent/loop.story.retried",
           data: {
             loopId,
@@ -485,7 +485,7 @@
     // Emit story fail event with duration
     const failDurationMs = storyStartedAt ? Date.now() - storyStartedAt : 0;
     await step.run("emit-story-fail", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-story-fail", {
         // ADR-0019: story.failed carries planner re-entry data (no separate plan emit)
         name: "agent/loop.story.failed",
         data: {
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/plan.ts b/packages/system-bus/src/inngest/functions/agent-loop/plan.ts
index 82b4fbd4108c89eeaaffe13a06e64031fce87157..1d66996b6cbd38e5bd28fa2415873e4ade170d52
--- a/packages/system-bus/src/inngest/functions/agent-loop/plan.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/plan.ts
@@ -360,7 +360,7 @@
       const completed = prd.stories.filter((s) => s.passes).length;
       const skipped = prd.stories.filter((s) => (s as any).skipped).length;
       await step.run("emit-complete-max-iterations", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-complete-max-iterations", {
           name: "agent/loop.completed",
           data: {
             loopId,
@@ -431,7 +431,7 @@
       ).length;
 
       await step.run("emit-complete", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-complete", {
           name: "agent/loop.completed",
           data: {
             loopId,
@@ -501,7 +501,7 @@
     }
 
     await step.run("emit-test", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-test", {
         name: "agent/loop.story.dispatched",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
index 3c83c21fa02bea7559914ce931a4ae83017d6812..b1383bc362b8c02f742decdea75ccb011d8f9318
--- a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
@@ -374,7 +374,7 @@
     });
 
     await step.run("emit-retro-complete", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-retro-complete", {
         name: "agent/loop.retro.completed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/review.ts b/packages/system-bus/src/inngest/functions/agent-loop/review.ts
index fdb3483ea6b09e8716907f517c7f1dfd03e8fd0f..bd4e2e3964c940d084eab65a9ed672274f846025
--- a/packages/system-bus/src/inngest/functions/agent-loop/review.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/review.ts
@@ -390,7 +390,7 @@
         return { blocked: true as const, reason: guard.reason };
       }
 
-      await step.sendEvent({
+      await step.sendEvent("emit-judge", {
         name: "agent/loop.checks.completed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/discovery-capture.ts b/packages/system-bus/src/inngest/functions/discovery-capture.ts
index 3242046b575b6624332261d736254e0546453729..029242aa4918d4b4e01cef37893c37aaeba83098
--- a/packages/system-bus/src/inngest/functions/discovery-capture.ts
+++ b/packages/system-bus/src/inngest/functions/discovery-capture.ts
@@ -98,7 +98,7 @@
       await $`slog write --action noted --tool discovery --detail "${title}" --reason "vault:Resources/discoveries/${result.noteName}.md"`.quiet();
 
       // Trigger sync to website
-      await step.sendEvent({
+      await step.sendEvent("slog-result", {
         name: "discovery/captured",
         data: {
           vaultPath: result.vaultPath,
diff --git a/packages/system-bus/src/inngest/functions/summarize.ts b/packages/system-bus/src/inngest/functions/summarize.ts
index e7d74e16a955bc29d0232d7e00938712f12f6eda..471957ca09e7942a1f8337f8784e899f1dc99bf2
--- a/packages/system-bus/src/inngest/functions/summarize.ts
+++ b/packages/system-bus/src/inngest/functions/summarize.ts
@@ -64,7 +64,7 @@
     await step.run("log-and-emit", async () => {
       await $`slog write --action summarize --tool content-summarize --detail "enriched: ${title}" --reason "content/summarize event via inngest"`.quiet();
 
-      await step.sendEvent({
+      await step.sendEvent("log-and-emit", {
         name: "content/summarized",
         data: { vaultPath, title },
       });


thinking
**Summarizing final outcome**
codex
Implemented SEND-3 across all remaining sites in `src/inngest/functions` by replacing `inngest.send()` with `step.sendEvent(stepId, payload)` and preserving the existing step IDs.

Updated call sites:
- `src/inngest/functions/agent-loop/retro.ts:377`
- `src/inngest/functions/agent-loop/implement.ts:456`
- `src/inngest/functions/agent-loop/judge.ts:390`
- `src/inngest/functions/agent-loop/judge.ts:425`
- `src/inngest/functions/agent-loop/judge.ts:488`
- `src/inngest/functions/agent-loop/review.ts:393`
- `src/inngest/functions/agent-loop/plan.ts:363`
- `src/inngest/functions/agent-loop/plan.ts:434`
- `src/inngest/functions/agent-loop/plan.ts:504`
- `src/inngest/functions/summarize.ts:67`
- `src/inngest/functions/discovery-capture.ts:101`

Validation:
- `grep -r "inngest.send" src/inngest/functions/ --include="*.ts" | grep -v test` returned no matches.
- `bunx tsc --noEmit` passed cleanly.
file update:
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/implement.ts b/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
index 801c2a13500bc20e5993ddaac429905c3bfb7436..e16733ef88a366fc24fdcc27ccd55a9983f80f12
--- a/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/implement.ts
@@ -453,7 +453,7 @@
         );
         return { blocked: true as const, reason: guard.reason };
       }
-      await step.sendEvent({
+      await step.sendEvent("emit-review", {
         name: "agent/loop.code.committed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/judge.ts b/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
index 19b349419cd56aae6bc622411abc5fa6ab197735..aaee63bf7d275fbf01920d502f487fd71f06afbd
--- a/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/judge.ts
@@ -387,7 +387,7 @@
 
       // ADR-0019: story.passed carries planner re-entry data (no separate plan emit)
       await step.run("emit-story-pass", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-story-pass", {
           name: "agent/loop.story.passed",
           data: {
             loopId,
@@ -422,7 +422,7 @@
 
       // ADR-0019: story.retried ‚Üí triggers implementor (skips test-writer on retry)
       await step.run("emit-retry-implement", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-retry-implement", {
           name: "agent/loop.story.retried",
           data: {
             loopId,
@@ -485,7 +485,7 @@
     // Emit story fail event with duration
     const failDurationMs = storyStartedAt ? Date.now() - storyStartedAt : 0;
     await step.run("emit-story-fail", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-story-fail", {
         // ADR-0019: story.failed carries planner re-entry data (no separate plan emit)
         name: "agent/loop.story.failed",
         data: {
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/plan.ts b/packages/system-bus/src/inngest/functions/agent-loop/plan.ts
index 82b4fbd4108c89eeaaffe13a06e64031fce87157..1d66996b6cbd38e5bd28fa2415873e4ade170d52
--- a/packages/system-bus/src/inngest/functions/agent-loop/plan.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/plan.ts
@@ -360,7 +360,7 @@
       const completed = prd.stories.filter((s) => s.passes).length;
       const skipped = prd.stories.filter((s) => (s as any).skipped).length;
       await step.run("emit-complete-max-iterations", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-complete-max-iterations", {
           name: "agent/loop.completed",
           data: {
             loopId,
@@ -431,7 +431,7 @@
       ).length;
 
       await step.run("emit-complete", async () => {
-        await step.sendEvent({
+        await step.sendEvent("emit-complete", {
           name: "agent/loop.completed",
           data: {
             loopId,
@@ -501,7 +501,7 @@
     }
 
     await step.run("emit-test", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-test", {
         name: "agent/loop.story.dispatched",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
index 3c83c21fa02bea7559914ce931a4ae83017d6812..b1383bc362b8c02f742decdea75ccb011d8f9318
--- a/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/retro.ts
@@ -374,7 +374,7 @@
     });
 
     await step.run("emit-retro-complete", async () => {
-      await step.sendEvent({
+      await step.sendEvent("emit-retro-complete", {
         name: "agent/loop.retro.completed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/agent-loop/review.ts b/packages/system-bus/src/inngest/functions/agent-loop/review.ts
index fdb3483ea6b09e8716907f517c7f1dfd03e8fd0f..bd4e2e3964c940d084eab65a9ed672274f846025
--- a/packages/system-bus/src/inngest/functions/agent-loop/review.ts
+++ b/packages/system-bus/src/inngest/functions/agent-loop/review.ts
@@ -390,7 +390,7 @@
         return { blocked: true as const, reason: guard.reason };
       }
 
-      await step.sendEvent({
+      await step.sendEvent("emit-judge", {
         name: "agent/loop.checks.completed",
         data: {
           loopId,
diff --git a/packages/system-bus/src/inngest/functions/discovery-capture.ts b/packages/system-bus/src/inngest/functions/discovery-capture.ts
index 3242046b575b6624332261d736254e0546453729..029242aa4918d4b4e01cef37893c37aaeba83098
--- a/packages/system-bus/src/inngest/functions/discovery-capture.ts
+++ b/packages/system-bus/src/inngest/functions/discovery-capture.ts
@@ -98,7 +98,7 @@
       await $`slog write --action noted --tool discovery --detail "${title}" --reason "vault:Resources/discoveries/${result.noteName}.md"`.quiet();
 
       // Trigger sync to website
-      await step.sendEvent({
+      await step.sendEvent("slog-result", {
         name: "discovery/captured",
         data: {
           vaultPath: result.vaultPath,
diff --git a/packages/system-bus/src/inngest/functions/summarize.ts b/packages/system-bus/src/inngest/functions/summarize.ts
index e7d74e16a955bc29d0232d7e00938712f12f6eda..471957ca09e7942a1f8337f8784e899f1dc99bf2
--- a/packages/system-bus/src/inngest/functions/summarize.ts
+++ b/packages/system-bus/src/inngest/functions/summarize.ts
@@ -64,7 +64,7 @@
     await step.run("log-and-emit", async () => {
       await $`slog write --action summarize --tool content-summarize --detail "enriched: ${title}" --reason "content/summarize event via inngest"`.quiet();
 
-      await step.sendEvent({
+      await step.sendEvent("log-and-emit", {
         name: "content/summarized",
         data: { vaultPath, title },
       });

tokens used
90,288
